# 정규화

> 정규화의 기본 목표는 테이블 간에 중복된 데이터를 허용하지 않는 것이다. 중복된 데이터를 허용하지 않음으로써 무결성을 유지할 수 있으며 DB의 저장 용량을 줄일 수 있다.
> 

## 제1 정규화

- 테이블의 컬럼이 `원자값`(하나의 값)을 갖도록 테이블을 분해하는 것이다.

### before table

| 이름 | 취미들 |
| --- | --- |
| 김연아 | 인터넷 |
| 추신수 | 영화, 음악 |

### after table
| 이름 | 취미 |
| --- | --- |
| 김연아 | 인터넷 |
| 추신수 | 영화 |
| 추신수 | 음악 |

## 제2 정규화

- 제1 정규화를 진행한 테이블에 대해, 기본키에 속하지 않은 모든 속성이 완전 함수 종속인 정규형이다.
- 완전 함수 종속이란 기본키의 부분집합이 결정자가 되어서는 안됨을 의미한다.
- 이행적 함수 종속성에 의해 제2 정규형에도 이상 현상이 존재한다.

### before table
- 수강 

  | 학생번호 | 강좌이름 | 강의실 | 성적 |
  | --- | --- | --- | --- |
  | 501 | 데이터베이스 | 공학관 110 | 3.5 |
  | 401 | 데이터베이스 | 공학관 110 | 4.0 |
  | 402 | 스포츠경영학 | 체육관 103 | 3.5 |

### after table
- 수강 

  | 학생번호 | 강좌이름 | 성적 |
  | --- | --- | --- |
  | 501 | 데이터베이스 | 3.5 |
  | 401 | 데이터베이스 | 4.0 |
  | 402 | 데이터베이스 | 4.0 |

### after table 
- 강의실 

  | 강좌이름 | 강의실 |
  | --- | --- |
  | 데이터베이스 | 공학관 110 |
  | 스포츠경영학 | 체육관 103 |


> 수강 테이블의 기본키는 [학생번호, 강좌이름] 복합키다. 그리고 기본키는 성적을 결정하고 있다.
강의실 컬럼은 기본키의 부분집합인 강좌 이름에 의해 결정된다. 
기본키의 부분키인 강좌이름이 결정자이므로 기존의 테이블에서 강의실을 분해하여 별도의 테이블로 관리해 제2 정규화를 만족시킬 수 있다.
> 


## 제3 정규화

- 제2 정규화를 진행한 테이블에 대해 이행적 종속을 없애도록 테이블을 분해하는 것이다.
- 이행적 종속이란 A → B, B → C, A → C가 성립됨을 의미한다.
- 기본키 이외의 컬럼이 다른 속성을 결정할 수 없는 것이다.

### before table 
- 계절학기 

  | 학생번호 | 강좌이름 | 수강료 |
  | --- | --- | --- |
  | 501 | 데이터베이스 | 20000 |
  | 401 | 데이터베이스 | 20000 |
  | 402 | 스포츠경영학 | 15000 |

### after table 
- 계절수강

  | 학생번호 | 강좌이름 |
  | --- | --- |
  | 501 | 데이터베이스 |
  | 401 | 데이터베이스 |
  | 402 | 스포츠경영학 |

### after table 
- 수강료

  | 강좌이름 | 수강료 |
  | --- | --- |
  | 데이터베이스 | 20000 |
  | 스포츠경영학 | 15000 |


> 기존 테이블에서 학생 번호는 강좌 이름을 결정하고 강좌 이름은 수강료를 결정한다.
그래서 [학생번호, 강좌이름] 테이블과 [강좌이름, 수강료] 테이블로 분해해야 한다.
이행적 종속을 제거하는 이유는 501번 학생의 수강 강좌가 데이터베이스 → 스포츠경영학이 될 경우 이행적 종속이 존재하면 501번 학생의 수강료는 20000원이 된다.
강좌 이름에 맞게 수강료를 다시 변경하면 되지만 번거러움을 해결하기 위해 제3 정규화를 한다.
학생 번호 → 강좌 이름 참조, 강좌 이름 → 수강료 참조하도록 테이블을 분해해야 한다.
> 


## BCNF 정규화

- 제3 정규화를 진행한 테이블에 대해 모든 결정자가 후보키가 되도록 테이블을 분해하는 것이다.

### before table
- 특강수강

  | 학생번호 | 특강이름 | 교수 |
  | --- | --- | --- |
  | 501 | 소셜네트워크 | 김교수 |
  | 401 | 인간과 동물 | 박교수 |
  | 402 | 창업전략 | 채교수 |

### after table
- 특강신청

  | 학생번호 | 교수 |
  | --- | --- |
  | 501 | 김교수 |
  | 401 | 박교수 |
  | 402 | 채교수 |

- 특강교수

  | 특강이름 | 교수 |
  | --- | --- |
  | 소셜네트워크 | 김교수 |
  | 인간과 동물 | 박교수 |
  | 창업전략 | 채교수 |


> 특강수강 테이블의 기본키는 [학생번호, 특강이름]이다. 
기본키는 교수를 결정하고 있고 교수는 특강이름을 결정하고 있다.
제3 정규형을 만족해도 이상 현상이 생기는데, 결정자가 후보키로 취급되고 있지 않기 때문이다.
후보키는 슈퍼키 중에 최소성을 갖는 키이므로 [학번, 과목명], [학번, 교수]가 후보키가 된다.
하지만 후보키가 아님에도 교수는 과목을 결정할 수 있어 결정자에 속한다. 

>- 삽입 이상 : 새로운 교수가 특정 과목을 담당한다면 새로운 정보를 추가할 수 없어 적어도 한 명 이상의 수강 학생이 필요하다.
> - 삭제 이상 : 학번 501이 소셜네트워크 과목을 취소하면 특강이름, 교수 정보도 삭제된다.
> - 갱신 이상 : 소셜네트워크 과목이 변경되면 모두 찾아 변경해야 한다.

> 그래서 BCNF 정규화를 만족하기 위해 특강신청 테이블과 특강교수 테이블로 분해할 수 있다.
모든 결정자는 항상 후보키가 되도록 릴레이션을 분해해주면 BCNF를 만족하게 된다.
> 

## 참고

- [정규화](https://mangkyu.tistory.com/110)
- [BCNF](https://rebro.kr/160)
